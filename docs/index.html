<!DOCTYPE html>
<html>

<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>LEGO Mosaic Builder</title>

<link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css" rel="stylesheet"/>

<style>

body{
background:#0f0f12;
color:white;
font-family:sans-serif;
text-align:center;
}

.builder{
max-width:900px;
margin:auto;
padding:40px 20px;
}

.controls{
margin-bottom:20px;
}

canvas{
max-width:100%;
background:black;
border-radius:12px;
}

#editorImage{
max-width:100%;
margin-bottom:20px;
}

</style>

</head>

<body>

<div class="builder">

<h1>Create Your LEGO Mosaic</h1>

<input type="file" id="upload">

<br><br>

<img id="editorImage">

<canvas id="pixelitcanvas"></canvas>

</div>

<img id="pixelitimg" style="display:none">

<script src="js/pixelit.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>

<script>

const editorImage = document.getElementById("editorImage");
const hiddenImg = document.getElementById("pixelitimg");
const canvas = document.getElementById("pixelitcanvas");

const LEGO_PALETTE = [
[0,0,0],
[255,255,255],
[214,0,28],
[0,85,191],
[242,205,55],
[160,165,169],
[24,70,50],
[138,110,95]
];

let cropper;

const px = new pixelit({
from:hiddenImg,
to:canvas
});

function renderLive(){

if(!cropper) return;

const cropped = cropper.getCroppedCanvas({
width:512,
height:512
});

hiddenImg.src = cropped.toDataURL();

hiddenImg.onload = () => {

px.draw();

const TARGET = 32;
const size = Math.max(canvas.width, canvas.height);

px.setScale(Math.floor(size/TARGET));

px.pixelate();

px.setpalette(LEGO_PALETTE);

px.convertpalette();

};

}

document.getElementById("upload").addEventListener("change", e=>{

const file = e.target.files[0];

if(!file) return;

editorImage.src = URL.createObjectURL(file);

editorImage.onload = () => {

if(cropper) cropper.destroy();

cropper = new Cropper(editorImage,{
aspectRatio:1,
viewMode:1,
dragMode:"move",
autoCropArea:1,
crop:()=> renderLive()
});

};

});

</script>

</body>

</html>
